#!/usr/bin/env sh

echo "Running pre-commit hook"

###################################################################
# Disallow commits to main branch                                 #
###################################################################
branch=$(git symbolic-ref HEAD)
if [[ "$branch" == "refs/heads/main" ]]; then
    # Get the commit message from the staged commit
    commit_msg=$(cat "$PWD/.git/COMMIT_EDITMSG" 2>/dev/null)

    # Check if it's a release commit
    if [[ ! "$commit_msg" =~ ^chore\(release\):\ v ]]; then
        echo "Direct commits to main branch are not allowed"
        echo "Please create a feature branch and submit a PR"
        echo "Only release commits (starting with 'chore(release): v') are allowed on main"
        exit 1
    fi
fi

###################################################################
# Format the staged files using lint-staged                       #
###################################################################
pnpm lint-staged
